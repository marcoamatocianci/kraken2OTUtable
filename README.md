# kraken2OTU

Creates a simple OTU table from Kraken2 report. It extracts the OTU names and their read counts. Then you can add all into one table.

# kraken2simplify

## Description

This script extracts read counts and OTU (species, genus or else) names, and writes it into a simple `.tsv` file.

## Usage

`python3 kraken2simplify.py <kraken2report> <level(s)>`

### Preparations

First, you have to generate reports with kraken2 by using --report and --use-names options enabled. 

### Using the script

The script needs two arguments. First argument is the file, which will be used for the extraction. Second needs to be the desired level, like G, S, P, G1 etc...
You can use multiple levels, separated by commas.

Example:

```
python3 kraken2simplify.py AB1-191021.kraken2report G,P,S,G1,F
```

This command will create 5 different files, each containing the OTUs of given level.
Example for genus:
From this (AB1-191021.kraken2report):

```
 72.33  440048  440048  U       0       unclassified
 27.67  168354  0       R       1       root
 27.67  168354  0       R1      131567    cellular organisms
 27.67  168354  1454    D       2           Bacteria
 23.46  142758  1804    P       1224          Proteobacteria
 17.38  105738  1070    C       1236            Gammaproteobacteria
  8.18  49747   24      O       72274             Pseudomonadales
  5.35  32566   36      F       135621              Pseudomonadaceae
  5.33  32447   4268    G       286                   Pseudomonas
  2.01  12219   3539    G1      196821                  unclassified Pseudomonas
```

  to this:
  (AB1-191021.kraken2report.G_only.tsv)

```
Pseudomonas     32447
Azotobacter     54
Permianibacter  13
Oblitimonas     11
Entomomonas     5
Acinetobacter   16974
Psychrobacter   79
Moraxella       70
Shewanella      24114
Parashewanella  14
```

# kraken2concat

## Description

This script takes a directory that contains `.tsv` files generated by `kraken2simplify.py`,
and creates a big OTU table containing all information.
It essentially performs an full outer join (a.k.a. `full_join` in R, and outer join in Python).

## Usage

`python3 kraken2concat.py <directory> <desired level>`

### Preparations

If you haven't done so, you should process your kraken reports with [kraken2simplify.py](#kraken2simplify).

`<directory>` should be the path to a directory that contains all files generated by the simplifier script.
You are recommanded to place the files created by the 'simplifier' script into a fresh directory for the better transparency,
but you don't have to.

The script will output as many files as many levels (S,G,O,F...) you give to it as second argument.
The output will be a `.tsv` file placed in current working directory.

### Example

`python3 kraken2concat.py ./all_sample_processed G`

This will merge all files into one table like below:

```
#OTU    EB1-211103.report.G     EB2-211103.report.G
Pseudomonas     32447   67432
Azotobacter     54      5324
Permianibacter  13      621
Oblitimonas     11      534
Entomomonas     5       52
Acinetobacter   16974   16974
Psychrobacter   79      96
Moraxella       70      70
Shewanella      24114   24114
```

###### Notes

The data here are from one file, I changed some values in EB1-* to get EB2 just to show how it works. It is good for many files too. Probably it works with Kraken 1 too, but I did not have the oppurtunity to try it.
